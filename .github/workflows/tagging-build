name: build

on:
  workflow_call:
    inputs:
      artifac-filename:
        required: true
        type: string

jobs:
  tagger-build:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: 🗳️ Checkout
        uses: actions/checkout@v2

      - name: 🎻 Obtener version de composer
        id: version-composer
        run: |
          VERSION=$(grep -m1 version composer.json | awk -F: '{ print $2 }' | sed 's/[", ]//g')
          echo "::set-output name=value::$VERSION"

      - name: 🗑️ Eliminamos
        run: |
          rm -rf .docker
          rm -rf .git
          rm -rf .gitignore
          rm -rf .editorconfig

      - name: 📚 Comprimimos
        run: |
          zip -r ${{inputs.artifac-filename}}.zip .

      - name: 🚀 Crear release
        uses: actions/create-release@v1
        with:
          draft: false
          prerelease: true
          release_name: ${{steps.version-composer.outputs.value}}-dev
          tag_name: ${{steps.version-composer.outputs.value}}-dev
        env:
          GITHUB_TOKEN: ${{ github.token }}

      - name: ☁️ Subiendo release
        uses: alexellis/upload-assets@0.2.2
        env:
          GITHUB_TOKEN: ${{ github.token }}
        with:
          asset_paths: '["${{inputs.artifac-filename}}.zip"]'
